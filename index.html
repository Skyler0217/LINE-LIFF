<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF Demo</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background: #f5f5f5;
        }
        .profile {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid #4caf50;
        }
        .info {
            margin-top: 10px;
            font-size: 16px;
            word-break: break-all;
        }
        .btn {
            margin-top: 20px;
            padding: 15px;
            width: 80%;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
        }
        .btn-blue {
            background: #2196F3; /* 藍色按鈕用於登入 */
        }
    </style>
</head>
<body>

    <h2>LINE LIFF 示範</h2>

    <div class="profile">
        <img id="pictureUrl" src="placeholder.png" alt="Profile Picture">
        <div class="info"><strong>名稱: <span id="displayName">未登入</span></strong></div>
        <div class="info">User ID: <span id="userId">---</span></div>
        <div class="info">Email: <span id="email">---</span></div>
    </div>
    
    <button class="btn" onclick="runTest()">測試</button>

    <button id="loginBtn" class="btn btn-blue" onclick="loginAndGetData()">登入並取得資料</button>

    <button id="logoutBtn" class="btn" onclick="logout()" style="display: none;">登出</button>

    <script>
        const LIFF_ID = "2008672268-SaERCbPj"; // 您的 LIFF ID

        async function initLIFF() {
            try {
                // 初始化 LIFF
                await liff.init({ liffId: LIFF_ID });
                console.log("LIFF initialized.");
                
                // 檢查登入狀態並更新 UI
                updateUI();

            } catch (error) {
                console.error("LIFF initialization failed: ", error);
                document.getElementById("displayName").innerText = "LIFF 初始化失敗";
            }
        }
        
        // 登入功能，並在登入後取得資料
        async function loginAndGetData() {
            if (!liff.isLoggedIn()) {
                // 執行登入，並跳轉回當前頁面
                liff.login();
            } else {
                // 如果已登入，則直接取得資料
                await getLIFFData();
            }
        }
        
        // 取得並顯示使用者資料
        async function getLIFFData() {
            try {
                const profile = await liff.getProfile();
                document.getElementById("displayName").innerText = profile.displayName;
                // 使用 profile.pictureUrl，如果沒有就用預設的 placeholder
                document.getElementById("pictureUrl").src = profile.pictureUrl || "placeholder.png"; 
                document.getElementById("userId").innerText = profile.userId;

                // 解析 Token 取得 email
                const decoded = liff.getDecodedIDToken();
                document.getElementById("email").innerText =
                    decoded.email ?? "尚未授權 email";
            } catch (error) {
                console.error("Failed to get profile data: ", error);
            }
        }

        // 根據登入狀態調整按鈕顯示
        function updateUI() {
            if (liff.isLoggedIn()) {
                document.getElementById("loginBtn").style.display = 'none';
                document.getElementById("logoutBtn").style.display = 'block';
                getLIFFData(); // 如果已經登入，直接抓取資料
            } else {
                document.getElementById("loginBtn").style.display = 'block';
                document.getElementById("logoutBtn").style.display = 'none';
            }
        }

        // 新增的測試功能
        function runTest() {
            alert("這是LINE LIFF喔");
        }

        // 登出功能
        function logout() {
            liff.logout();
            // 登出後重新載入頁面，讓 UI 變回未登入狀態
            window.location.reload(); 
        }

        initLIFF();
    </script>

</body>

</html>
